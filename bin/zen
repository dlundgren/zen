#!/usr/bin/env php
<?php
declare(strict_types=1);

use WoohooLabs\Zen\Container\Builder\FileSystemContainerBuilder;

if (version_compare("7.1.0", PHP_VERSION, ">")) {
    fwrite(
        STDERR,
        "Woohoo Labs. Zen requires PHP 7.1 or later." . PHP_EOL
    );

    die(1);
}

require getAutoloadPath();

if (isset($argv[1]) === false) {
    die(1);
}

if ($argv[1] === "build") {
    $containerFilePath = $argv[2];
    $compilerConfig = new $argv[3]();

    $builder = new FileSystemContainerBuilder($compilerConfig, $containerFilePath);
    $builder->build();
}

function getAutoloadPath(): string
{
    $paths = [
        __DIR__ . "/../../../autoload.php",
        __DIR__ . "/../../vendor/autoload.php",
        __DIR__ . "/../vendor/autoload.php",
    ];

    foreach ($paths as $file) {
        if (file_exists($file)) {
            return $file;
        }
    }

    fwrite(STDERR, "You need Composer to set up the project dependencies!" . PHP_EOL);
    die(1);
}
